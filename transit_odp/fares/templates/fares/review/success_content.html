{% load i18n %}
{% load crispy_forms_tags %}
{% load waffle_tags %}


{# Preview Section #}
{% flag "is_fares_validator_active" %}
    <div class="govuk-!-margin-top-6" id="preview-section">
        {# Fares Validator Section - Succes/Fail Message #}
        {% if validator_error %}
            <div class="app-dqs-panel govuk-!-margin-bottom-7">
                <div class="app-dqs-panel__body">
                    <div class="app-dqs-panel__success">
                        <h2 class="govuk-heading-m">Validation Check - Failed</h2>
                        <p class="govuk-body">
                            {% blocktrans %}
                                The validation report checks for compliance against the mandated NeTEx Profile.
                            {% endblocktrans %}
                            <br />
                            <br />
                            <a class="govuk-link" href="{% url 'transit_odp.fares_exporter' pk1 pk2 host hosts.publish %}">Download validation report</a>
                            <br />
                        </p>
                        <p class="govuk-body govuk-!-margin-bottom-0">
                            {% blocktrans %}
                                The fares data supplied is non-compliant. You can publish this
                                dataset now, however it is important to address the issues
                                highightlighted in the report with your supplier. Please contact
                                the helpdesk if there are any items on the report which your
                                supplier cannot help you with.
                            {% endblocktrans %}
                        </p>
                    </div>
                </div>
            </div>
            <h3 class="govuk-heading-m govuk-!-margin-top-6">Recommended actions</h3>
            <div class="govuk-button-group">
                <a role="button" class="govuk-button app-!-mr-sm-4" href=
                    "{% url 'fares:feed-update' pk1=pk1 pk=object.dataset_id host hosts.publish %}"
                >
                    {{ _('Update data') }}
                </a>
                <a role="button" class="govuk-button govuk-button--secondary"
                    href="{% url 'fares:revision-delete' pk1=pk1 pk=object.dataset_id host hosts.publish %}"
                >
                    {{ _('Delete data') }}
                </a>
            </div>
            <p class="govuk-body-m govuk-!-font-weight-bold">Your data needs to be improved, and we do not recommend publishing non-compliant data.</p>
            <div class="govuk-checkboxes govuk-checkboxes--small" data-module="govuk-checkboxes">
                <div class="govuk-checkboxes__item">
                    <input class="govuk-checkboxes__input" id="id_consent" name="consent" type="checkbox" required>
                    <label class="govuk-label govuk-checkboxes__label" for="id_consent">
                        I acknowledge my data does not meet the required standard, as detailed in the validation report, and I am publishing non-compliant data to the Bus Open Data Service.
                    </label>
                </div>
            </div>
            <a role="button" class="govuk-button govuk-button--secondary govuk-!-margin-top-2"
                href="{% url 'fares:revision-publish' pk=object.dataset_id pk1=pk1 host hosts.publish %}"
            >
                {{ _('Publish non-compliant data') }}
            </a>
        {% else %}
            <div class="app-dqs-panel govuk-!-margin-bottom-7">
                <div class="app-dqs-panel__body">
                    <div class="app-dqs-panel__success">
                        <h2 class="govuk-heading-m govuk-!-margin-bottom-0">Validation Check - Passed</h2>
                    </div>
                </div>
            </div>
            {# Publish form #}
            <div class="govuk-!-margin-bottom-6">
                {% crispy form %}
            </div>
        {% endif %}
{% else %}
    <div id="preview-section">
{% endflag %}

<hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

<h2 class="govuk-heading-l dont-break-out">
    {{ object.name }}
</h2>
{% include 'publish/snippets/dataset_map.html' %}
{% include 'fares/review/property_table.html' %}

<div class="btn-group-justified">
    <a role="button" class="govuk-button govuk-button--secondary"
        href="{% url 'fares:revision-delete' pk1=pk1 pk=object.dataset_id host hosts.publish %}">
        {{ _('Delete data set') }}
    </a>
</div>
</div>
